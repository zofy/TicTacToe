/**
 * Created by Patrik on 16. 3. 2016.
 */
var menu={};menu.name="",menu.init=function(){this.findPlayers(),this.getName(),this.vsComp(),this.setActions()},menu.manageJson=function(n){"name"in n?($("#notifications h2").text(n.name+" wants to play with you!"),$("#notifications span").html("<button>Yes</button> <button>No</button>")):"connection_drop"in n&&$("#notifications h2").text("Connection with "+n.connection_drop+" dropped down!")},menu.vsComp=function(){$("button").click(function(){location.href="/ttt/comp/3/"})},menu.getPlayers=function(n){$("#search_results").html(""),console.log(n.names),n.names.forEach(function(n){console.log(n),$("#search_results").append('<li><span style="cursor: pointer"><i class="fa fa-user-plus"></i></span>'+n+"</li>")})},menu.findPlayers=function(){$("#search").keyup(function(){$.ajax({type:"POST",url:"/ttt/menu/searchPlayer/",data:{player:$("#search").val(),csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:menu.getPlayers,dataType:"json"})})},menu.refreshPlayers=function(){$.ajax({type:"GET",url:"/ttt/menu/searchPlayer/",success:menu.getPlayers,dataType:"json"})},menu.getName=function(){$.ajax({type:"GET",url:"/ttt/menu/getUser/",success:function(n){console.log(n.name),menu.name=n.name},dataType:"json"})},menu.setActions=function(){$("h1 .fa-search").click(function(){$('#container input[type="text"]').fadeToggle()}),$("#search_results").on("click","span",function(n){console.log($(this).parent().text()),menu.ws.send('{"status": 0, "request": "'+$(this).parent().text()+'"}'),$(this).parent().fadeOut(500,function(){$(this).remove()}),n.stopPropagation()}),$("#notifications span").on("click","button",function(){console.log("You clicked on one of the answer buttons.")})},menu.sendMessage=function(){console.log("posielam spravu"),$.ajax({type:"POST",url:"/ttt/menu/sendMsg/",data:{user:menu.name,csrfmiddlewaretoken:$("input[name=csrfmiddlewaretoken]").val()},success:function(n){console.log(n),menu.ws.send(n.msg)},dataType:"json"})},menu.init(),menu.ws=new WebSocket("ws://localhost:9001/"),menu.ws.onmessage=function(n){try{var e=JSON.parse(n.data);menu.manageJson(e)}catch(t){console.log(n.data),"make_request"==n.data&&menu.refreshPlayers()}},menu.ws.onopen=function(){console.log("Connection established!"),""!=menu.name&&(console.log("posielam status"),menu.sendMessage())},menu.ws.onclose=function(){menu.ws.close()};